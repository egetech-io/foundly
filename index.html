<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Foundly — Найди свой путь</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --ink: #0f0e0c;
    --paper: #f5f0e8;
    --cream: #ede8dc;
    --accent: #c84b2f;
    --accent-light: #e8896e;
    --muted: #8a8278;
    --border: #d4cfc5;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--paper);
    color: var(--ink);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ── LANDING ── */
  #landing {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
  }

  .grain {
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 100;
    opacity: 0.6;
  }

  nav {
    padding: 2rem 3rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--border);
  }

  .logo {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    font-weight: 900;
    letter-spacing: -0.02em;
    color: var(--ink);
  }

  .logo span { color: var(--accent); }

  .nav-tag {
    font-size: 0.75rem;
    font-weight: 500;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    border: 1px solid var(--border);
    padding: 0.4rem 0.9rem;
    border-radius: 2rem;
  }

  .hero {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 4rem 3rem 3rem;
    max-width: 900px;
  }

  .hero-eyebrow {
    font-size: 0.75rem;
    font-weight: 500;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.6rem;
  }

  .hero-eyebrow::before {
    content: '';
    display: block;
    width: 2rem;
    height: 1px;
    background: var(--accent);
  }

  h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(3rem, 6vw, 5.5rem);
    font-weight: 900;
    line-height: 1.0;
    letter-spacing: -0.03em;
    margin-bottom: 2rem;
    color: var(--ink);
  }

  h1 em {
    font-style: italic;
    color: var(--accent);
  }

  .hero-desc {
    font-size: 1.125rem;
    line-height: 1.65;
    color: var(--muted);
    max-width: 520px;
    margin-bottom: 3rem;
    font-weight: 300;
  }

  .cta-row {
    display: flex;
    align-items: center;
    gap: 2rem;
  }

  .btn-primary {
    background: var(--ink);
    color: var(--paper);
    border: none;
    padding: 1rem 2.5rem;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.95rem;
    font-weight: 500;
    letter-spacing: 0.02em;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    overflow: hidden;
  }

  .btn-primary::after {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--accent);
    transform: translateX(-100%);
    transition: transform 0.3s ease;
  }

  .btn-primary:hover::after { transform: translateX(0); }
  .btn-primary span { position: relative; z-index: 1; }

  .cta-note {
    font-size: 0.8rem;
    color: var(--muted);
    font-weight: 300;
  }

  .hero-visual {
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 38%;
    height: 70vh;
    background: var(--cream);
    border-left: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 2.5rem;
    gap: 1.2rem;
    overflow: hidden;
  }

  .stat-card {
    background: white;
    border: 1px solid var(--border);
    padding: 1.4rem 1.6rem;
    position: relative;
    transition: transform 0.2s ease;
  }

  .stat-card:hover { transform: translateX(-4px); }

  .stat-num {
    font-family: 'Playfair Display', serif;
    font-size: 2rem;
    font-weight: 900;
    color: var(--ink);
    line-height: 1;
    margin-bottom: 0.4rem;
  }

  .stat-num span { color: var(--accent); }

  .stat-desc {
    font-size: 0.78rem;
    color: var(--muted);
    line-height: 1.5;
  }

  .stat-source {
    font-size: 0.62rem;
    color: var(--border);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-top: 0.5rem;
  }

  .stat-card.dark {
    background: var(--ink);
    border-color: var(--ink);
  }

  .stat-card.dark .stat-num { color: var(--paper); }
  .stat-card.dark .stat-num span { color: var(--accent-light); }
  .stat-card.dark .stat-desc { color: rgba(245,240,232,0.5); }
  .stat-card.dark .stat-source { color: rgba(245,240,232,0.2); }

  /* ── STEPS ── */
  .steps-row {
    display: flex;
    border-top: 1px solid var(--border);
    margin-top: auto;
  }

  .step {
    flex: 1;
    padding: 1.5rem 3rem;
    border-right: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .step:last-child { border-right: none; }

  .step-num {
    font-family: 'Playfair Display', serif;
    font-size: 2rem;
    font-weight: 900;
    color: var(--border);
    line-height: 1;
    flex-shrink: 0;
  }

  .step-text {
    font-size: 0.85rem;
    color: var(--muted);
    line-height: 1.4;
  }

  .step-text strong {
    display: block;
    color: var(--ink);
    font-weight: 500;
    margin-bottom: 0.2rem;
  }

  /* ── CHAT ── */
  #chat-screen {
    display: none;
    min-height: 100vh;
    flex-direction: column;
  }

  .chat-nav {
    padding: 1.25rem 2.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--border);
    background: var(--paper);
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .chat-logo {
    font-family: 'Playfair Display', serif;
    font-size: 1.2rem;
    font-weight: 900;
    color: var(--ink);
  }

  .chat-logo span { color: var(--accent); }

  .progress-wrap {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .progress-label {
    font-size: 0.75rem;
    color: var(--muted);
    font-weight: 500;
  }

  .progress-bar {
    width: 140px;
    height: 3px;
    background: var(--border);
    border-radius: 2px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: var(--accent);
    border-radius: 2px;
    transition: width 0.5s ease;
    width: 0%;
  }

  .chat-body {
    flex: 1;
    padding: 2.5rem;
    max-width: 740px;
    margin: 0 auto;
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .msg {
    display: flex;
    gap: 1rem;
    animation: msgIn 0.4s ease forwards;
    opacity: 0;
    transform: translateY(12px);
  }

  @keyframes msgIn {
    to { opacity: 1; transform: translateY(0); }
  }

  .msg-avatar {
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    font-weight: 700;
    letter-spacing: 0.05em;
  }

  .msg.ai .msg-avatar {
    background: var(--ink);
    color: var(--paper);
    font-family: 'Playfair Display', serif;
  }

  .msg.user .msg-avatar {
    background: var(--accent);
    color: white;
    font-size: 0.65rem;
  }

  .msg.user { flex-direction: row-reverse; }

  .msg-bubble {
    max-width: 82%;
    padding: 1rem 1.4rem;
    line-height: 1.65;
    font-size: 0.92rem;
  }

  .msg.ai .msg-bubble {
    background: white;
    border: 1px solid var(--border);
    color: var(--ink);
    border-radius: 0 12px 12px 12px;
  }

  .msg.user .msg-bubble {
    background: var(--ink);
    color: var(--paper);
    border-radius: 12px 0 12px 12px;
  }

  .typing {
    display: flex;
    gap: 4px;
    padding: 0.4rem 0;
  }

  .typing span {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--muted);
    animation: blink 1.2s ease infinite;
  }

  .typing span:nth-child(2) { animation-delay: 0.2s; }
  .typing span:nth-child(3) { animation-delay: 0.4s; }

  @keyframes blink {
    0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); }
    40% { opacity: 1; transform: scale(1); }
  }

  /* input */
  .chat-input-wrap {
    border-top: 1px solid var(--border);
    padding: 1.5rem 2.5rem;
    background: var(--paper);
    position: sticky;
    bottom: 0;
    display: flex;
    gap: 1rem;
    max-width: 740px;
    margin: 0 auto;
    width: 100%;
  }

  /* override sticky to be full width */
  .input-outer {
    border-top: 1px solid var(--border);
    background: var(--paper);
    position: sticky;
    bottom: 0;
    z-index: 10;
  }

  .chat-input {
    flex: 1;
    background: white;
    border: 1px solid var(--border);
    padding: 0.85rem 1.2rem;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.92rem;
    color: var(--ink);
    outline: none;
    resize: none;
    transition: border-color 0.2s;
    border-radius: 4px;
    min-height: 50px;
    max-height: 120px;
  }

  .chat-input:focus { border-color: var(--ink); }
  .chat-input::placeholder { color: var(--muted); }

  .send-btn {
    background: var(--ink);
    color: var(--paper);
    border: none;
    width: 50px;
    height: 50px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    border-radius: 4px;
    transition: background 0.2s;
  }

  .send-btn:hover { background: var(--accent); }
  .send-btn:disabled { opacity: 0.4; cursor: not-allowed; }

  /* ── PDF PREVIEW ── */
  #pdf-screen {
    display: none;
    min-height: 100vh;
    background: #2a2a2a;
    padding: 2rem;
  }

  .pdf-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
  }

  .pdf-logo {
    font-family: 'Playfair Display', serif;
    font-size: 1.2rem;
    font-weight: 900;
    color: white;
  }

  .pdf-logo span { color: var(--accent-light); }

  .pdf-actions { display: flex; gap: 1rem; }

  .btn-outline {
    background: transparent;
    border: 1px solid rgba(255,255,255,0.3);
    color: white;
    padding: 0.6rem 1.4rem;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
    border-radius: 4px;
  }

  .btn-outline:hover { border-color: white; background: rgba(255,255,255,0.1); }

  .btn-download {
    background: var(--accent);
    border: none;
    color: white;
    padding: 0.6rem 1.4rem;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
    border-radius: 4px;
  }

  .btn-download:hover { background: #a33a20; }

  /* PDF Document */
  .pdf-doc {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    box-shadow: 0 40px 120px rgba(0,0,0,0.4);
    animation: docIn 0.6s ease forwards;
    opacity: 0;
    transform: translateY(20px);
  }

  @keyframes docIn {
    to { opacity: 1; transform: translateY(0); }
  }

  .pdf-cover {
    background: var(--ink);
    padding: 4rem;
    color: var(--paper);
    position: relative;
    overflow: hidden;
  }

  .pdf-cover::before {
    content: '';
    position: absolute;
    right: -4rem;
    top: -4rem;
    width: 20rem;
    height: 20rem;
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 50%;
  }

  .pdf-cover::after {
    content: '';
    position: absolute;
    right: -2rem;
    top: -2rem;
    width: 14rem;
    height: 14rem;
    border: 1px solid rgba(255,255,255,0.04);
    border-radius: 50%;
  }

  .pdf-brand {
    font-family: 'Playfair Display', serif;
    font-size: 0.8rem;
    font-weight: 700;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--accent-light);
    margin-bottom: 3rem;
  }

  .pdf-cover-title {
    font-family: 'Playfair Display', serif;
    font-size: 2.5rem;
    font-weight: 900;
    line-height: 1.1;
    margin-bottom: 1rem;
    position: relative;
  }

  .pdf-cover-sub {
    font-size: 0.95rem;
    color: rgba(245,240,232,0.5);
    font-weight: 300;
    margin-bottom: 3rem;
  }

  .pdf-meta {
    display: flex;
    gap: 3rem;
    border-top: 1px solid rgba(255,255,255,0.1);
    padding-top: 2rem;
  }

  .pdf-meta-item { }
  .pdf-meta-label {
    font-size: 0.65rem;
    font-weight: 700;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: rgba(245,240,232,0.4);
    margin-bottom: 0.3rem;
  }
  .pdf-meta-value {
    font-size: 0.85rem;
    color: var(--paper);
  }

  .pdf-content { padding: 3rem 4rem; }

  .pdf-section {
    margin-bottom: 2.5rem;
    padding-bottom: 2.5rem;
    border-bottom: 1px solid var(--border);
    animation: sectionIn 0.5s ease forwards;
    opacity: 0;
  }

  .pdf-section:last-child { border-bottom: none; }

  @keyframes sectionIn {
    to { opacity: 1; }
  }

  .section-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.2rem;
  }

  .section-num {
    font-family: 'Playfair Display', serif;
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--accent);
    border: 1px solid var(--accent);
    width: 1.8rem;
    height: 1.8rem;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .section-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--ink);
  }

  .section-body {
    font-size: 0.88rem;
    line-height: 1.75;
    color: #3a3630;
    padding-left: 2.8rem;
  }

  .tag-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    padding-left: 2.8rem;
    margin-top: 0.8rem;
  }

  .tag {
    font-size: 0.72rem;
    font-weight: 500;
    letter-spacing: 0.05em;
    padding: 0.3rem 0.8rem;
    border: 1px solid var(--border);
    color: var(--muted);
    border-radius: 2rem;
  }

  .tag.accent {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
  }

  .risk-item {
    display: flex;
    gap: 0.8rem;
    align-items: flex-start;
    margin-bottom: 0.6rem;
    padding-left: 2.8rem;
  }

  .risk-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--accent);
    flex-shrink: 0;
    margin-top: 0.45rem;
  }

  .risk-text { font-size: 0.88rem; line-height: 1.6; color: #3a3630; }

  .steps-list {
    padding-left: 2.8rem;
    counter-reset: step-counter;
  }

  .step-item {
    display: flex;
    gap: 1rem;
    margin-bottom: 0.7rem;
    align-items: flex-start;
  }

  .step-count {
    font-family: 'Playfair Display', serif;
    font-size: 0.8rem;
    font-weight: 900;
    color: var(--accent);
    flex-shrink: 0;
    width: 1.5rem;
    padding-top: 0.05rem;
  }

  .step-desc { font-size: 0.88rem; line-height: 1.6; color: #3a3630; }

  .metrics-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    padding-left: 2.8rem;
  }

  .metric-card {
    background: var(--cream);
    padding: 1rem 1.2rem;
    border-left: 2px solid var(--accent);
  }

  .metric-name { font-size: 0.72rem; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; color: var(--muted); margin-bottom: 0.3rem; }
  .metric-val { font-family: 'Playfair Display', serif; font-size: 1.2rem; font-weight: 900; color: var(--ink); }
  .metric-desc { font-size: 0.72rem; color: var(--muted); margin-top: 0.2rem; }

  .tools-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.6rem;
    padding-left: 2.8rem;
  }

  .tool-item {
    background: var(--cream);
    padding: 0.7rem 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .tool-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--ink); flex-shrink: 0; }
  .tool-name { font-size: 0.8rem; font-weight: 500; }
  .tool-cat { font-size: 0.65rem; color: var(--muted); }

  .pdf-footer {
    background: var(--cream);
    padding: 1.5rem 4rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top: 1px solid var(--border);
  }

  .footer-brand { font-family: 'Playfair Display', serif; font-size: 0.85rem; font-weight: 700; color: var(--muted); }
  .footer-note { font-size: 0.72rem; color: var(--muted); }

  /* util */
  .hidden { display: none !important; }
</style>
</head>
<body>
<div class="grain"></div>

<!-- ══════════ LANDING ══════════ -->
<div id="landing">
  <nav>
    <div class="logo">Found<span>ly</span></div>
    <div class="nav-tag">Бета · 2026</div>
  </nav>

  <div class="hero">
    <div class="hero-eyebrow">AI-навигатор для предпринимателей</div>
    <h1>Твоя идея.<br>Наш <em>план.</em></h1>
    <p class="hero-desc">
      Расскажи нам о своей идее — Foundly задаст правильные вопросы
      и создаст персональную стратегию запуска в формате PDF.
    </p>
    <div class="cta-row">
      <button class="btn-primary" onclick="startChat()">
        <span>Начать бесплатно →</span>
      </button>
      <span class="cta-note">~15 минут · без регистрации</span>
    </div>
  </div>

  <div class="hero-visual">
    <div class="stat-card dark">
      <div class="stat-num"><span>90%</span></div>
      <div class="stat-desc">стартапов терпят неудачу из-за отсутствия чёткой стратегии на старте — не из-за плохой идеи</div>
      <div class="stat-source">Harvard Business Review</div>
    </div>
    <div class="stat-card">
      <div class="stat-num">$<span>3.2</span>трлн</div>
      <div class="stat-desc">объём мирового рынка стартапов. Большинство основателей начинали без опыта и денег</div>
      <div class="stat-source">Statista, 2024</div>
    </div>
    <div class="stat-card">
      <div class="stat-num"><span>27</span> лет</div>
      <div class="stat-desc">средний возраст основателя самого успешного стартапа. Начать никогда не рано — и не поздно</div>
      <div class="stat-source">MIT Sloan Study</div>
    </div>
    <div class="stat-card dark">
      <div class="stat-num"><span>15</span> мин</div>
      <div class="stat-desc">столько занимает диалог с Foundly. На выходе — персональная стратегия запуска твоего бизнеса</div>
      <div class="stat-source">Foundly</div>
    </div>
  </div>

  <div class="steps-row">
    <div class="step">
      <div class="step-num">01</div>
      <div class="step-text">
        <strong>Диалог с AI</strong>
        Отвечаешь на точные вопросы о своей идее
      </div>
    </div>
    <div class="step">
      <div class="step-num">02</div>
      <div class="step-text">
        <strong>Анализ и стратегия</strong>
        Foundly строит модель и проверяет идею
      </div>
    </div>
    <div class="step">
      <div class="step-num">03</div>
      <div class="step-text">
        <strong>Готовый PDF</strong>
        Персональный план запуска у тебя в руках
      </div>
    </div>
  </div>
</div>

<!-- ══════════ CHAT ══════════ -->
<div id="chat-screen" style="display:none; flex-direction:column; min-height:100vh;">
  <div class="chat-nav">
    <div class="chat-logo">Found<span>ly</span></div>
    <div class="progress-wrap">
      <span class="progress-label" id="progress-label">Вопрос 1 из 8</span>
      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
      </div>
    </div>
  </div>

  <div class="chat-body" id="chat-body"></div>

  <div class="input-outer">
    <div class="chat-input-wrap" style="max-width:740px; margin:0 auto; padding:1.5rem 2.5rem; display:flex; gap:1rem;">
      <textarea class="chat-input" id="user-input" placeholder="Напиши свой ответ здесь..." rows="1"
        onkeydown="handleKey(event)"></textarea>
      <button class="send-btn" id="send-btn" onclick="sendMessage()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- ══════════ PDF ══════════ -->
<div id="pdf-screen" style="display:none; min-height:100vh; background:#2a2a2a; padding:2rem;">
  <div style="max-width:800px; margin:0 auto;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem;">
      <div style="font-family:'Playfair Display',serif; font-size:1.2rem; font-weight:900; color:white;">
        Found<span style="color:#e8896e">ly</span>
      </div>
      <div style="display:flex; gap:1rem;">
        <button class="btn-outline" onclick="restartApp()">← Начать заново</button>
        <button class="btn-download" onclick="downloadPDF()">↓ Скачать PDF</button>
      </div>
    </div>
    <div class="pdf-doc" id="pdf-doc"></div>
  </div>
</div>

<script>
// ─── DATA ───
const SYSTEM_PROMPT = `# Системный промпт для Foundly AI-ассистента

## Role
Ты — AI-партнёр по созданию бизнес-стратегий с опытом запуска стартапов, анализа рынков и проверки идей. Ты работаешь на уровне стратега и ментора, который помогает людям не просто оформить мысль, а найти идею с нуля и довести её до конкретного плана действий. Ты не исполнитель запросов — ты проводник от смутного желания "хочу создать бизнес" до готовой персональной стратегии в формате PDF.

## Context
Ты работаешь в рамках продукта Foundly — веб-сервиса для начинающих предпринимателей, которые хотят запустить свой первый бизнес, но не знают с чего начать. Большинство пользователей: не имеют чёткой бизнес-идеи, не понимают свою целевую аудиторию, не знают как проверить спрос, боятся ошибиться и потратить деньги впустую, перегружены информацией и не могут начать действовать.

Твоя задача — провести живой диалог (8–12 вопросов), который помогает пользователю родить идею, если её нет, или оформить её, если она сырая. На выходе ты генерируешь персональный PDF-документ со структурированной стратегией запуска.

## Goals
Твоя цель — за один диалог (15–20 минут):
1. Помочь пользователю найти или сформулировать идею, если он пришёл с размытым желанием "хочу что-то создать"
2. Выявить реальную ценность идеи через наводящие вопросы о боли клиента
3. Собрать достаточно данных для создания практичной стратегии с конкретными шагами, метриками и инструментами
4. Снизить страх старта — показать что проверить идею можно быстро, дёшево и без риска
5. Выдать на выходе готовый PDF с 9 разделами: резюме идеи, бизнес-модель, целевая аудитория, рынок и конкуренты, риски, план первых 30 дней, метрики, бюджет, стек инструментов

## Constraints
**Что тебе НЕЛЬЗЯ:**
1. Не задавай сразу сложные вопросы — начинай с простого и открытого, а потом углубляйся
2. Не принимай расплывчатые ответы — если пользователь говорит "хочу помогать людям" или "не знаю", задай уточняющий вопрос
3. Не уходи в теорию и длинные объяснения — каждый вопрос короткий, понятный и ведёт к действию
4. Не предлагай идеи за пользователя — наводи на мысль через вопросы
5. Не перегружай диалог — задавай по одному вопросу за раз
6. Не используй бизнес-жаргон без объяснения
7. Не пропускай критические блоки — целевая аудитория, бизнес-модель, страхи, успех
8. Не задавай больше 12 вопросов

**Когда задавать уточняющие вопросы:**
- Пользователь отвечает односложно
- Описывает идею слишком абстрактно
- Называет аудиторию слишком широко
- Не понимает отличия от конкурентов

## Output format
Каждое твоё сообщение:
1. Короткая реакция на ответ пользователя (1–2 предложения)
2. Следующий вопрос — чёткий, конкретный, один
3. Опциональная подсказка (если нужно)

Структура диалога:
1. Вводный вопрос — что интересует, есть ли идея
2. Если идеи нет — помоги найти через интересы, навыки, проблемы
3. Если идея есть — попроси описать в одном предложении
4. Целевая аудитория — конкретный портрет клиента
5. Боль клиента — какую проблему решаешь
6. Конкурентное преимущество — почему ты
7. Бизнес-модель — как зарабатывать
8. Бюджет — сколько готов вложить
9. Главный страх — что пугает
10. Критерий успеха — что будет через год
11. Финальный вопрос — что хочет добавить

После 8–12 вопросов скажи: "Отлично, у меня есть всё что нужно. Сейчас составлю твою персональную стратегию — это займёт несколько секунд."

## Tone & behavior
**Как общаешься:**
- Говори как старший друг-предприниматель
- Будь поддерживающим, но честным
- Простой язык, без жаргона
- Коротко — 2–4 предложения максимум
- Один восклицательный знак на сообщение максимум
- Избегай клише

**Как ведёшь себя:**
- Партнёр, не помощник
- Честен про риски
- Фокус на действии

**Недопустимо:**
- Мотивационные речи
- Излишняя вежливость
- Философствование
- Длинные абзацы без вопроса`;

let conversationHistory = [];
let questionCount = 0;
let isTyping = false;
let collectedData = {};

function startChat() {
  document.getElementById('landing').style.display = 'none';
  const chatScreen = document.getElementById('chat-screen');
  chatScreen.style.display = 'flex';
  
  // Инициализируем диалог
  conversationHistory = [];
  questionCount = 0;
  
  setTimeout(() => getAIResponse(), 400);
}

function updateProgress() {
  const estimatedTotal = 10;
  const pct = Math.min((questionCount / estimatedTotal) * 100, 95);
  document.getElementById('progress-fill').style.width = pct + '%';
  document.getElementById('progress-label').textContent =
    questionCount === 0
      ? 'Начинаем диалог'
      : `Вопрос ${questionCount}`;
}

async function getAIResponse() {
  if (isTyping) return;

  isTyping = true;
  document.getElementById('send-btn').disabled = true;

  showTyping();
  updateProgress();

  try {

    const response = await fetch('/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        systemPrompt: SYSTEM_PROMPT,
        messages:
          conversationHistory.length === 0
            ? [{ role: 'user', content: 'Привет, я хочу создать бизнес' }]
            : conversationHistory
      })
    });

    const data = await response.json();

    if (!response.ok)
      throw new Error(data.error || 'AI error');

    const aiMessage = data.text;

    removeTyping();
    addMessage(aiMessage, 'ai');

    conversationHistory.push({
      role: 'assistant',
      content: aiMessage
    });

    questionCount++;

    if (
      aiMessage.includes('персональную стратегию') ||
      questionCount >= 12
    ) {
      setTimeout(generatePDF, 2000);
    } else {
      isTyping = false;
      document.getElementById('send-btn').disabled = false;
      document.getElementById('user-input').focus();
    }

  } catch (error) {
    console.error(error);
    removeTyping();
    addMessage('⚠️ Ошибка AI. Попробуй позже.', 'ai');
    isTyping = false;
  }
}

function addMessage(text, role) {
  const body = document.getElementById('chat-body');
  const msg = document.createElement('div');
  msg.className = 'msg ' + role;

  const avatar = document.createElement('div');
  avatar.className = 'msg-avatar';
  avatar.textContent = role === 'ai' ? 'F' : 'Я';

  const bubble = document.createElement('div');
  bubble.className = 'msg-bubble';
  bubble.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');

  msg.appendChild(avatar);
  msg.appendChild(bubble);
  body.appendChild(msg);
  body.scrollTop = body.scrollHeight;
}

function showTyping() {
  const body = document.getElementById('chat-body');
  const msg = document.createElement('div');
  msg.className = 'msg ai';
  msg.id = 'typing-indicator';

  const avatar = document.createElement('div');
  avatar.className = 'msg-avatar';
  avatar.textContent = 'F';

  const bubble = document.createElement('div');
  bubble.className = 'msg-bubble';
  bubble.innerHTML = '<div class="typing"><span></span><span></span><span></span></div>';

  msg.appendChild(avatar);
  msg.appendChild(bubble);
  body.appendChild(msg);
  body.scrollTop = body.scrollHeight;
}

function removeTyping() {
  const t = document.getElementById('typing-indicator');
  if (t) t.remove();
}

function sendMessage() {
  if (isTyping) return;
  const input = document.getElementById('user-input');
  const text = input.value.trim();
  if (!text) return;

  addMessage(text, 'user');
  conversationHistory.push({ role: 'user', content: text });
  input.value = '';
  
  setTimeout(() => getAIResponse(), 600);
}

function handleKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
}

// ─── PDF GENERATION ───
function generatePDF() {
  document.getElementById('chat-screen').style.display = 'none';
  const pdfScreen = document.getElementById('pdf-screen');
  pdfScreen.style.display = 'block';

  // Извлекаем данные из диалога
  const userMessages = conversationHistory.filter(m => m.role === 'user').map(m => m.content);
  
  const idea = userMessages[0] || 'Ваша бизнес-идея';
  const audience = userMessages[1] || 'Целевая аудитория';
  const advantage = userMessages[2] || 'Конкурентное преимущество';
  const model = userMessages[3] || 'Бизнес-модель';
  const budget = userMessages[4] || 'Стартовый бюджет';
  const risk = userMessages[5] || 'Основные риски';
  const success = userMessages[6] || 'Критерии успеха';
  const extra = userMessages[7] || '';

  const today = new Date().toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' });
  const shortTitle = idea.length > 60 ? idea.slice(0, 60) + '…' : idea;

  document.getElementById('pdf-doc').innerHTML = `
    <div class="pdf-cover">
      <div class="pdf-brand">Foundly · Стратегия запуска</div>
      <div class="pdf-cover-title">${shortTitle}</div>
      <div class="pdf-cover-sub">Персональная стратегия, созданная на основе твоего диалога с Foundly</div>
      <div class="pdf-meta">
        <div class="pdf-meta-item">
          <div class="pdf-meta-label">Дата</div>
          <div class="pdf-meta-value">${today}</div>
        </div>
        <div class="pdf-meta-item">
          <div class="pdf-meta-label">Стартовый бюджет</div>
          <div class="pdf-meta-value">${budget}</div>
        </div>
        <div class="pdf-meta-item">
          <div class="pdf-meta-label">Горизонт</div>
          <div class="pdf-meta-value">12 месяцев</div>
        </div>
      </div>
    </div>

    <div class="pdf-content">

      <div class="pdf-section" style="animation-delay:0.1s">
        <div class="section-header">
          <div class="section-num">01</div>
          <div class="section-title">Резюме идеи</div>
        </div>
        <div class="section-body">${idea}</div>
        ${extra ? `<div class="section-body" style="margin-top:0.8rem; font-style:italic; color:var(--muted)">Дополнительный контекст: ${extra}</div>` : ''}
      </div>

      <div class="pdf-section" style="animation-delay:0.2s">
        <div class="section-header">
          <div class="section-num">02</div>
          <div class="section-title">Бизнес-модель</div>
        </div>
        <div class="section-body">${model}</div>
        <div class="tag-row">
          <span class="tag accent">Модель монетизации</span>
          <span class="tag">Проверить на старте</span>
          <span class="tag">Масштабируемая</span>
        </div>
      </div>

      <div class="pdf-section" style="animation-delay:0.3s">
        <div class="section-header">
          <div class="section-num">03</div>
          <div class="section-title">Целевая аудитория</div>
        </div>
        <div class="section-body">${audience}</div>
      </div>

      <div class="pdf-section" style="animation-delay:0.35s">
        <div class="section-header">
          <div class="section-num">04</div>
          <div class="section-title">Конкурентное преимущество</div>
        </div>
        <div class="section-body">${advantage}</div>
      </div>

      <div class="pdf-section" style="animation-delay:0.4s">
        <div class="section-header">
          <div class="section-num">05</div>
          <div class="section-title">Риски и типичные ошибки</div>
        </div>
        <div class="risk-item"><div class="risk-dot"></div><div class="risk-text">${risk}</div></div>
        <div class="risk-item"><div class="risk-dot"></div><div class="risk-text">Слишком ранний запуск полного продукта без проверки спроса — начни с MVP.</div></div>
        <div class="risk-item"><div class="risk-dot"></div><div class="risk-text">Отсутствие первых разговоров с клиентами — поговори с 10 потенциальными покупателями до вложения денег.</div></div>
        <div class="risk-item"><div class="risk-dot"></div><div class="risk-text">Распыление бюджета на маркетинг до подтверждения продукта.</div></div>
      </div>

      <div class="pdf-section" style="animation-delay:0.45s">
        <div class="section-header">
          <div class="section-num">06</div>
          <div class="section-title">План первых 30 дней</div>
        </div>
        <div class="steps-list">
          <div class="step-item"><div class="step-count">1.</div><div class="step-desc"><strong>Неделя 1:</strong> Поговори с 10 потенциальными клиентами. Задай один вопрос: «Как ты сейчас решаешь эту проблему?»</div></div>
          <div class="step-item"><div class="step-count">2.</div><div class="step-desc"><strong>Неделя 2:</strong> Создай простейший прототип — лендинг или Telegram-канал. Опиши идею и посмотри на реакцию.</div></div>
          <div class="step-item"><div class="step-count">3.</div><div class="step-desc"><strong>Неделя 3:</strong> Найди первых 3 пользователей, готовых попробовать продукт бесплатно в обмен на обратную связь.</div></div>
          <div class="step-item"><div class="step-count">4.</div><div class="step-desc"><strong>Неделя 4:</strong> Сделай первый тест монетизации — попроси заплатить символическую сумму. Реакция на оплату скажет больше, чем любой опрос.</div></div>
        </div>
      </div>

      <div class="pdf-section" style="animation-delay:0.5s">
        <div class="section-header">
          <div class="section-num">07</div>
          <div class="section-title">Ключевые метрики проверки</div>
        </div>
        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-name">Целевой успех</div>
            <div class="metric-val">${success.slice(0,30)}</div>
            <div class="metric-desc">Твой ориентир через 12 мес.</div>
          </div>
          <div class="metric-card">
            <div class="metric-name">Первая проверка</div>
            <div class="metric-val">10 клиентов</div>
            <div class="metric-desc">До вложения любых денег</div>
          </div>
          <div class="metric-card">
            <div class="metric-name">Конверсия в оплату</div>
            <div class="metric-val">> 10%</div>
            <div class="metric-desc">Из заинтересованных в платящих</div>
          </div>
          <div class="metric-card">
            <div class="metric-name">Срок до MVP</div>
            <div class="metric-val">30 дней</div>
            <div class="metric-desc">Первая рабочая версия</div>
          </div>
        </div>
      </div>

      <div class="pdf-section" style="animation-delay:0.55s">
        <div class="section-header">
          <div class="section-num">08</div>
          <div class="section-title">Стек инструментов для старта</div>
        </div>
        <div class="tools-grid">
          <div class="tool-item"><div class="tool-dot"></div><div><div class="tool-name">Tilda</div><div class="tool-cat">Сайт / лендинг</div></div></div>
          <div class="tool-item"><div class="tool-dot"></div><div><div class="tool-name">Telegram</div><div class="tool-cat">Коммуникация</div></div></div>
          <div class="tool-item"><div class="tool-dot"></div><div><div class="tool-name">Notion</div><div class="tool-cat">База знаний</div></div></div>
          <div class="tool-item"><div class="tool-dot"></div><div><div class="tool-name">ЮКасса</div><div class="tool-cat">Приём платежей</div></div></div>
          <div class="tool-item"><div class="tool-dot"></div><div><div class="tool-name">Figma</div><div class="tool-cat">Дизайн / прототип</div></div></div>
          <div class="tool-item"><div class="tool-dot"></div><div><div class="tool-name">Claude / GPT</div><div class="tool-cat">AI-инструменты</div></div></div>
        </div>
      </div>

      <div class="pdf-section" style="animation-delay:0.6s; border-bottom:none;">
        <div class="section-header">
          <div class="section-num">09</div>
          <div class="section-title">Минимальный стартовый бюджет</div>
        </div>
        <div class="section-body">
          На основе твоего ответа: <strong>${budget}</strong>.<br><br>
          Рекомендация Foundly: первый месяц тратить только на проверку гипотезы — 
          разговоры с клиентами стоят 0 рублей. Деньги вкладывай только после 
          подтверждения спроса. Большинство идей можно протестировать за <strong>5 000–30 000 ₽</strong> 
          до любых серьёзных инвестиций.
        </div>
      </div>

    </div>

    <div class="pdf-footer">
      <div class="footer-brand">Foundly</div>
      <div class="footer-note">Создано с помощью AI · ${today}</div>
    </div>
  `;

  // animate sections
  document.querySelectorAll('.pdf-section').forEach((s, i) => {
    s.style.animationDelay = (0.1 + i * 0.08) + 's';
  });
}

function downloadPDF() {
  window.print();
}

function restartApp() {
  conversationHistory = [];
  questionCount = 0;
  isTyping = false;
  collectedData = {};
  document.getElementById('chat-body').innerHTML = '';
  document.getElementById('pdf-screen').style.display = 'none';
  document.getElementById('landing').style.display = 'flex';
}
</script>
</body>
</html>
